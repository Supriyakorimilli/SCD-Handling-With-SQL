MERGE INTO TYPE1_STUDENT AS t1
USING STUDENT_STAGE AS t2
ON t1.STUDENTID = t2.STUDENTID
WHEN MATCHED AND (
    t1.FIRSTNAME <> t2.FIRSTNAME OR
    t1.LASTNAME <> t2.LASTNAME OR
    t1.BIRTHDATE <> t2.BIRTHDATE OR
    t1.ADDRESS <> t2.ADDRESS
)
THEN 
UPDATE SET
    t1.FIRSTNAME = t2.FIRSTNAME,
    t1.LASTNAME = t2.LASTNAME,
    t1.BIRTHDATE = t2.BIRTHDATE,
    t1.ADDRESS = t2.ADDRESS,
    t1.UPDATETIMESTAMP = CURRENT_TIMESTAMP
WHEN NOT MATCHED BY TARGET THEN
INSERT (STUDENTID, FIRSTNAME, LASTNAME, BIRTHDATE, ADDRESS, INSERTTIMESTAMP, UPDATETIMESTAMP)
VALUES (t2.STUDENTID, t2.FIRSTNAME, t2.LASTNAME, t2.BIRTHDATE, t2.ADDRESS, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP);
